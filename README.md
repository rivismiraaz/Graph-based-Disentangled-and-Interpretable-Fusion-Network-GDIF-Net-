# Neural Multi-Modal Risk Field for UAV Inspection (GDIF-Net)

This project implements a novel framework for creating a dynamic, interpretable, and evolvable 3D risk perception field for Unmanned Aerial Vehicle (UAV) operations, particularly in public safety contexts.

The core of the project is the **Graph-based Disentangled and Interpretable Fusion Network (GDIF-Net)**, a deep learning model designed to fuse heterogeneous information sources into a unified, explainable risk map.

## Core Features

- **Innovative Modeling**: Utilizes a Graph Attention Network (GATv2) to model spatial relationships, allowing the model to learn transferable "rules" of risk interaction rather than memorizing locations. This provides exceptional generalization to new, unseen scenarios.
- **Disentangled Representation**: Each risk modality (e.g., crowd density, wind) is first encoded into a separate, meaningful latent space before fusion, solving the challenge of combining heterogeneous data.
- **Interpretable Fusion**: An attention-based mechanism fuses the disentangled factors, providing explicit, real-time weights that show which modality is contributing most to the risk at any given point.
- **Real-time 3D Visualization**: A high-performance 3D visualizer built with PyVista renders the risk field, uncertainty map, and contribution heatmaps in real-time.
- **Interactive Simulator**: A GUI control panel, built with Dear PyGui, allows for the dynamic, real-time adjustment of all risk source parameters, including adding, moving, and deleting hotspots.
- **Point-based Explainability (XAI)**: A "Risk Inspector" feature allows users to **Shift + Click** on any point in the 3D view to get an immediate, detailed breakdown of the risk score, uncertainty, and the contribution of each modality at that specific location.

## Architecture

The project is composed of four main components:

1.  **Simulator (`simulators/`)**: Generates dynamic, multi-modal data fields based on user-defined parameters.
2.  **Core Model (`core/`)**: Contains the GDIF-Net (PyTorch + PyG), graph construction logic, and the heuristic risk function for generating training labels.
3.  **Visualization (`visualization/`)**: Manages the 3D rendering of the risk field using PyVista.
4.  **Main Application (`main.py`)**: Integrates the simulator, model, and visualizer, and provides the main GUI and control logic.

## Setup and Installation

1.  **Prerequisites**:
    - Python 3.8+
    - A CUDA-enabled GPU is highly recommended for decent performance.

2.  **Install Dependencies**:
    First, install PyTorch according to your specific CUDA version. Visit the [official PyTorch website](https://pytorch.org/get-started/locally/) for instructions. For example, for CUDA 11.8:
    ```bash
    pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
    ```

3.  **Install PyTorch Geometric**:
    Next, install the required PyTorch Geometric packages.
    ```bash
    pip install torch_geometric
    pip install pyg_lib torch_scatter torch_sparse -f https://data.pyg.org/whl/torch-${TORCH}+${CUDA}.html
    ```
    (Replace `${TORCH}` and `${CUDA}` with your PyTorch and CUDA versions, e.g., `torch-2.1.0+cu118`)

4.  **Install Remaining Packages**:
    Finally, install the rest of the dependencies from the `requirements.txt` file.
    ```bash
    pip install -r requirements.txt
    ```

## How to Use

### 1. (Optional) Generate Training Data

The model can be trained on synthetic data to learn the desired risk logic.

```bash
python generate_dataset.py
```
This will create a `training_data/` directory filled with thousands of diverse, simulated scenarios and their corresponding "ground truth" risk labels, generated by the heuristic function in `core/heuristic_risk.py`.

### 2. (Optional) Train the Model

Train the GDIF-Net on the generated dataset.

```bash
python train.py
```
This script will train the model for a number of epochs and save the final weights to `gdif_net_final.pth`.

### 3. Run the Simulator

Launch the main application. It will automatically load `gdif_net_final.pth` if it exists.

```bash
python main.py
```

- **Control Panel**: Use the GUI to adjust parameters for each risk modality. You can add or remove crowd/traffic hotspots dynamically.
- **3D View**: The PyVista window displays the 3D risk field.
- **Risk Inspector**: Hold **Shift** and **Left-Click** on a point in the 3D volume. The "Risk Inspector" panel will update with a detailed analysis of that specific point.
